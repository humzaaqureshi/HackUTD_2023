<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Shell Prediction</title>
    <link href="shell.css" rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <py-env>
      - openai
      - os
      - dotenv
      - random
      - bs4
      - requests
    </py-env>
  </head>
  <body>
    <div class="about">
        <img src="pictures/header_image.jpeg" class="headim" width="24%">
        <img src="pictures/logo.jpg" class="dp">
        <div class="info">
            <h1>Shell Prediction</h1>
            <br>
            <a href='oil.html'><button class="back">Back To Companies</button></a>
            <a href='index.html'><button class="return">Return To Homepage</button></a>
        </div>
    </div>
    <div class="menu">
      <h1 style="margin-top: -2%;">Assessment</h1>
      <br>
      <br>
      <py-script>
        from bs4 import BeautifulSoup
        from dotenv import load_dotenv
        import random as rand
        async function installBeautifulSoup() {
          try {
            await micropip.install("beautifulsoup4");
            print("Beautiful Soup 4 has been successfully installed.");
          } catch (error) {
            print("Error installing Beautiful Soup 4:", error);
          }
        }
        
        installBeautifulSoup();
        from bs4 import BeautifulSoup
        def scraper(url, company, arttype = "article"):
          page = requests.get(url)
          article = BeautifulSoup(page.text, 'html.parser')
          if arttype == "article":
            article = article.find_all('p')
          elif arttype == "list":
            article = article.find_all('li')
          text = []
          file = None
          file = open(f"{company}prompt.txt", "w")
          for x in article:
            if ('\n') not in x.text and len(x.text) > 100: 
              text.append(x.text)
          for x in text:
            file.write(x)
            file.write('\n')
    
        def prompter(ind):
          companies = ["Exxon", "Saudi Aramco", "Shell"]
          urls = ['https://www.reuters.com/business/energy/sarabia-other-opec-producers-announce-voluntary-oil-output-cuts-2023-04-02/','https://www.cnbc.com/2022/02/24/russian-forces-invade-ukraine.html','https://www.cnbc.com/2021/06/09/tc-energy-terminates-keystone-xl-pipeline-project.html']
          company = companies[ind]    
          scraper(rand.choice(urls), company)
          prompt = None
          prompt = open(f"{company}prompt.txt", "w")
          article = open(f'{company}.txt','r')
          artiline = ''
          for line in article:
            artiline += line
          prompt.write(f'Based off the following article : "{artiline}", how do you think this will affect {company}s future earnings? Give a concise answer based of market sentiment. Begin your response with based on market sentiment.')
          prompt.close()
        
        load_dotenv()
        api_key = os.environ['API_KEY']
        openai.api_key = api_key
        def run(ind):
          prompter(ind)
          messages = [ {"role": "system", "content":  
                      "You are a intelligent assistant."} ] 
          companies = ["Exxon", "Saudi Aramco", "Shell"]
          company = companies[ind]
          promptfile = open(f'{company}prompt.txt','r')
          message = promptfile.read()
          if message: 
              messages.append( 
                  {"role": "user", "content": message}, 
              ) 
              chat = openai.ChatCompletion.create( 
                  model="gpt-3.5-turbo-16k", messages=messages 
              ) 
          reply = chat.choices[0].message.content 
          print(f"ChatGPT: {reply}") 
          messages.append({"role": "assistant", "content": reply})
          print("")
        run(2)
    </py-script>
      <br>
    </div>
   <br>
   <br>
</body>
</html>